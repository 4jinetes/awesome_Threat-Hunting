##Mitre Attack

|NO|Rule Name|Description|Author|OS Product Platform|MITRE Attack Techniques|Log Source|Rule Content|
|---|---|---|---|---|---|---|---|
|1|Console History| Checks for execution of Console History  | Mohammad Ghanbari  | Windows  | |sysmon| EventID=1 ( CommandLine="*Get-History*" OR CommandLine="*AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txt*"  OR  CommandLine="*(Get-PSReadlineOption).HistorySavePath*") |
|2| Named Pipes | Checks for  Named Pipes	| Mohammad Ghanbari	| Windows | |sysmon| EventID=17 pipe_name IN ( "\\isapi_http*","\\isapi_dg*" ,"\\isapi_dg2*" ,"\\isapi_http*" , "\\sdlrpc*" ,"\\aheec*" ,"\\winsession*" ,"\\lsassw*","\\rpchlp_3*"  ,"\\NamePipe_MoreWindows*" ,"\\pcheap_reuse*" , "\\PSEXESVC*" ,"\\PowerShellISEPipeName_*"  ,"\\csexec*"  , "\\paexec*" ,"\\remcom*") |
|3| Named Pipes-CobaltStrike | Checks for  Named Pipes |Mohammad Ghanbari|Windows| |sysmon|EventID=17 pipe_name="\\msagent_*" |
|4| Remotely Query Login Sessions - Network | Checks for execution of Remotely Query Login Sessions | Mohammad Ghanbari | Windows	| |sysmon | EventID=3 Image="*\\qwinsta.exe" OR Process="qwinsta.exe" | 
|5| Suspicious filename used | Checks for execution of Suspicious filename | Mohammad Ghanbari |Windows | | sysmon | EventID=1 Image IN ("*\\a.exe" , "*\\b.exe" , "*\\c.exe" , "*\\d.exe" , "*\\e.exe" , "*\\f.exe" ,"*\\g.exe" , "*\\h.exe" , "*\\i.exe" ,"*\\j.exe" ,"*\\k.exe","*\\l.exe" ,"*\\m.exe" ,"*\\n.exe" ,"*\\o.exe" ,"*\\p.exe" ,"*\\q.exe" ,"*\\r.exe" ,"*\\s.exe" ,"*\\t.exe" ,"*\\u.exe" ,"*\\v.exe" ,"*\\w.exe" ,"*\\x.exe" ,"*\\y.exe" ,"*\\z.exe" ,"*\\1.exe" ,"*\\2.exe" ,"*\\3.exe" ,"*\\4.exe" ,"*\\5.exe" ,"*\\6.exe" ,"*\\7.exe" ,"*\\8.exe" ,"*\\9.exe" , "*\\0.exe" ,"*\\10.exe") OR Process IN ( "a.exe" , "b.exe" , "c.exe" , "d.exe" , "e.exe" , "f.exe" ,"g.exe" , "h.exe" , "i.exe" ,"j.exe" ,"k.exe","l.exe" ,"m.exe" ,"n.exe" ,"o.exe" ,"p.exe" ,"q.exe" ,"r.exe" ,"s.exe" ,"t.exe" ,"u.exe" ,"v.exe" ,"w.exe" ,"x.exe" ,"y.exe" ,"z.exe" ,"1.exe" ,"2.exe" ,"3.exe" ,"4.exe" ,"5.exe" ,"6.exe" ,"7.exe" ,"8.exe" ,"9.exe" , "0.exe" ,"10.exe") | 
|6| Data Compressed | Checks for execution of MITRE ATT&CK T1002 | Mohammad Ghanbari | Windows | T1002 | sysmon | EventID=1 ((Image="*\\powershell.exe" OR Process="powershell.exe") CommandLine="*-Recurse*Compress-Archive*") OR  ((Image="*\\rar.exe" OR Process="rar.exe") CommandLine="rar\*a\*") | 
|7| Credential Dumping - ImageLoad | Checks for execution of Credential Dumping | Mohammad Ghanbari | Windows | T1003 | sysmon | EventId=7  ImageLoaded IN (  "C:\\Windows\\System32\\samlib.dll","C:\\Windows\\System32\\WinSCard.dll" , "C:\\Windows\\System32\\cryptdll.dll" , "C:\\Windows\\System32\\hid.dll" ,  "C:\\Windows\\System32\\vaultcli.dll" )  AND ( process_path!="*\\Sysmon.exe"  OR  process_path!="*\\svchost.exe" OR   process_path!="*\\logonui.exe") |
|8| Credential Dumping - Process | Checks for execution of Credential Dumping | Mohammad Ghanbari | Windows | T1004 | sysmon | EventID=1 CommandLine IN ("*Invoke-Mimikatz -DumpCreds*" ,"gsecdump* -a" , "wce* -o" , "procdump* -ma lsass.exe*" , "ntdsutil*ac i ntds*ifm*create full") |
|9| Credential Dumping-Process Access | Checks for execution of Credential Dumping | Mohammad Ghanbari | Windows | T1005 | sysmon | EventID=10 TargetImage="C:\\Windows\\system32\\lsass.exe"  GrantedAccess IN ("0x1010" , "0x1410"  , " 0x147a" ,"0x143a" )  CallTrace="C:\\Windows\\SYSTEM32\\ntdll.dll\*|C:\\Windows\\system32\\KERNELBASE.dll*|*UNKNOWN*" | 
|10| Credential Dumping-Registry	| Checks for execution of Credential Dumping | Mohammad Ghanbari | Windows | T1006 | sysmon	| "(EventID = 12 OR EventID = 13 OR EventID = 14)  process_path!=""C:\\WINDOWS\\system32\\lsass.exe" "(object_path  IN  ""*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Authentication\\Credential Provider\\*"" , ""*\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\*"" ,  ""*\\SYSTEM\\CurrentControlSet\\Control\\SecurityProviders\\SecurityProviders\\*"" , ""*\\Control\\SecurityProviders\\WDigest\\*"" ) AND  object_path!= ""*\\Lsa\\RestrictRemoteSamEventThrottlingWindow""" |
|11| Credential Dumping-Registry Save | Checks for execution of Credential Dumping | Mohammad Ghanbari | Windows | T1007 | sysmon	| EventID=1 (Image="*\\reg.exe" OR Process="reg.exe" ) ( CommandLine="*save*HKLM\\sam*"  OR CommandLine="*save*HKLM\\system*") |
|12| Winlogon Helper DLL | Checks for execution of MITRE ATT&CK | Mohammad Ghanbari | Windows |T1004 |sysmon |(EventID = 12 or EventID = 13 or EventID = 14)  object_path  IN ( "*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\user_nameinit\\*" , \\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell\\*" , "*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify\\*") | 
|13|Query Registry-Process|Checks for execution of MITRE ATT&CK T1012 | Mohammad Ghanbari	| Windows| T1012 |sysmon|EventID=1 ( Image="*\\reg.exe" OR process_name="reg.exe"  ) CommandLine="*reg*query*" |
|14|Local Port Monitor	| Checks for execution of MITRE ATT&CK T1013 | Mohammad Ghanbari | Windows | T1013 | sysmon	| (EventID = 12 OR  EventID = 13 OR  EventID = 14)  object_path="*\\SYSTEM\CurrentControlSet\Control\Print\Monitors\\*" |
|15|Accessibility features | Checks for execution of MITRE ATT&CK T1015	| Mohammad Ghanbari	| Windows | T1015 | sysmon | EventID=1  ParentImage="*\\winlogon.exe"  ( Image IN ( "*\\sethc.exe" ,"*\\utilman.exe" ,"*\\osk.exe","*\\magnify.exe" , "*\\displayswitch.exe" ,  "*\\narrator.exe", "*\\atbroker.exe") OR Process IN ( "sethc.exe" ,"utilman.exe" ,"osk.exe","magnify.exe" , "displayswitch.exe" ,  "narrator.exe", "atbroker.exe")) |
|16| Accessibility Features-Registry| Checks for execution of MITRE ATT&CK T1016|Mohammad Ghanbari|Windows|T1016|sysmon|(EventID = 12 or EventID = 13 or EventID = 14)  object_path="*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\*" |
|17|Remote System Discovery-Network|Checks for execution of MITRE ATT&CK T1018|Mohammad Ghanbari|Windows|T1018|sysmon|EventID=1 (CommandLine="*net.exe*" CurrentDirectory="*config*" ) OR CommandLine IN ("*ipconfig.exe*" ,"*netsh.exe*" , "*arp.exe*" ,"*nbtstat.exe*") | 
|18|Remote System Discovery-Process|Checks for execution of MITRE ATT&CK T1018|Mohammad Ghanbari|Windows|T1019|sysmon|EventID=1 Image="*\\net.exe" OR Image="*\\ping.exe" CommandLine="*view*" OR CommandLine="*ping*" |
|19|Obfuscated Files or Information|Checks for execution of MITRE ATT&CK T1027|Mohammad Ghanbari|Windows|T1027|sysmon|EventID=1 (Image="*\\certutil.exe" OR Process="certutil.exe") CommandLine="*encode*" OR CommandLine="*ToBase64String*" | 
|20|Windows Remote Management|Checks for execution of MITRE ATT&CK T1028|Mohammad Ghanbari|Windows|T1028|sysmon|EventID=1 ((Image="*\\wsmprovhost.exe" OR Process="wsmprovhost.exe") OR  (Image="*\\winrm.cmd" OR Process="winrm.cmd")) (CommandLine="*Enable-PSRemoting -Force*" OR  CommandLine="*Invoke-Command -computer_name*" OR CommandLine="wmic*node*process call create*")| 
|21|Modify Existing Service|Checks for execution of MITRE ATT&CK T1031|Mohammad Ghanbari|Windows|T1031|sysmon|EventID=1 ((Image="*\\sc.exe" OR Process="sc.exe") OR (Image="*\\powershell.exe" OR Process="powershell.exe")  OR (Image="*\\cmd.exe" OR Process="cmd.exe")) CommandLine="*sc*config*binpath*" |
|22|System Owner/User Discovery|Checks for execution of MITRE ATT&CK T1033|Mohammad Ghanbari|Windows|T1033|sysmon|EventID=1 (process_path="*\\whoami.exe"  OR CommandLine="*whoami*" OR process_path ="*\\qwinsta.exe"  OR process_path = "*\\quser.exe" OR  process_path = "*\\systeminfo.exe"|
|23|System Owner/User Discovery - Network|Checks for execution of MITRE ATT&CK T1033|Mohammad Ghanbari|Windows|T1033|sysmon|EventID=3 dest_port=389 OR dest_port=636 OR dest_port=445 OR dest_port=8080
|24|Masquerading - Extension|Checks for execution of MITRE ATT&CK T1036|Mohammad Ghanbari|Windows|T1036|sysmon|EventID=1 process_name  IN ( "*.doc.*" , "*.docx.*" , "*.xls.*" ,"*.xlsx.*" , "*.pdf.*" , "*.rtf.*"  , "*.jpg.*", "*.png.*" ,"*.jpeg.*" , "*.zip.*" ,  "*.rar.*"  ,"*.ppt.*" , "*.pptx.*"  )|
|25|Masquerading - Location|Checks for execution of MITRE ATT&CK T1036|Mohammad Ghanbari|Windows|T1036|sysmon|EventID=11 file_path IN ( "*SysWOW64*" ,"*System32*", "*AppData*" ,"*Temp*") file_name IN ("*.exe" , "*.dll" , "*.bat" , "*.com" , "*.ps1" ,"*.py" ,"*.js" ,"*.vbs" ,"*.hta" )|
|26|Logon Scripts|Checks for execution of MITRE ATT&CK T1037|Mohammad Ghanbari|Windows|T1037|sysmon|EventID=1 CommandLine="*REG*ADD*\\Environment*UserInitMprLogonScript*"|
|27|Network Sniffing|Checks for execution of MITRE ATT&CK T1040|Mohammad Ghanbari|Windows|T1040	|sysmon|EventID=1 process_name  IN ("windump.exe", "logman.exe","tcpdump.exe" ,"wprui.exe","wpr.exe")|
|28|Change Default File Association|Checks for execution of MITRE ATT&CK T1042|Mohammad Ghanbari|Windows|T1042|sysmon|(EventID = 12 or EventID = 13 or EventID = 14)  object_path= "*\\SOFTWARE\\Classes\\*\\*"  OR object_path= "*\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\GlobalAssocChangedCounter"|
|29|Windows Management Instrumentation-Instances of an Active Script Event Consumer-Process|Checks for execution of MITRE ATT&CK T1047|Mohammad Ghanbari|Windows|T1047|sysmon|EventID=1  ParentCommandLine="C:\\Windows\\System32\\svchost.exe" OR CommandLine="C:\\WINDOWS\\system32\\wbem\\scrcons.exe"|
|30|Windows Management Instrumentation - Process|Checks for execution of MITRE ATT&CK T1047|Mohammad Ghanbari|Windows|T1047|sysmon|EventID=3 Image="*\\wmic.exe" CommandLine="*wmic*"|
|31|Windows Management Instrumentation - Process|Checks for execution of MITRE ATT&CK T1047|Mohammad Ghanbari|Windows|T1047|sysmon|EventID=1 ParentCommandLine="*wmiprvse.exe" OR process_path="*\\wmic.exe" OR CommandLine="*wmic*"|
|32|System Network Connections Discovery|Checks for execution of MITRE ATT&CK T1049|Mohammad Ghanbari|Windows|T1050|sysmon|EventID=1 ( Process="net.exe OR Process="netstat.exe" ) ( CommandLine="*net*use" OR CommandLine="*net*sessions*" OR CommandLine="*net*file*" OR CommandLine="*netstat*" ) OR CommandLine="*Get-NetTCPConnection*"|
|33|New Service - Process|Checks for execution of MITRE ATT&CK T1050|Mohammad Ghanbari|Windows|T1050|sysmon|EventID=1 Proccess="sc.exe" OR Proccess="powershell.exe" OR Proccess="cmd.exe" CommandLine IN ("*New-Service*BinaryPathName*" , "*sc*create*binpath*" , "*Get-WmiObject*Win32_Service*create*")|
|34|Scheduled Task - Process|Checks for execution of MITRE ATT&CK T1053|Mohammad Ghanbari|Windows|T1053|sysmon|EventID=1 Image="*\\taskeng.exe" OR  Image="*\\schtasks.exe" OR (Image="*\\svchost.exe"  ParentCommandLine!="C:\\Windows\\System32\\services.exe")|
|35|Indicator Blocking - Driver unloaded|Checks for execution of MITRE ATT&CK T1054|Mohammad Ghanbari|Windows|T1054|sysmon|EventID=1 Process="fltmc.exe" OR CommandLine="*fltmc*unload*"|
|36|Indicator Blocking - Sysmon registry edited from other source|Checks for execution of MITRE ATT&CK T1054|Mohammad Ghanbari|Windows|T1054|"""(EventID = 12 OR EventID = 13 OR EventID = 14)  (Image!=""""*\\Sysmon64.exe"""" OR Image!=""""Sysmon.exe"""") object_path  IN  (""""*\\System\\CurrentControlSet\\Services\\SysmonDrv\\*"""" , """"*\\System\\CurrentControlSet\\Services\\Sysmon\\*"""" ,""""*\\System\\CurrentControlSet\\Services\\Sysmon64\\*"""")"""|
|37|Process Injection - Process|Checks for execution of MITRE ATT&CK T1055|Mohammad Ghanbari|Windows|T1055|sysmon|EventID=1 CommandLine="*Invoke-DllInjection*"  OR CommandLine="c:\\windows\sysnative\\"|
|38|Process Discovery|Checks for execution of MITRE ATT&CK T1075|Mohammad Ghanbari|Windows|T1075|EventID=1 Image="*\\tasklist.exe" CommandLine="*Get-Process*"|
|39|Command-Line Interface|Checks for execution of MITRE ATT&CK T1059|Mohammad Ghanbari|Windows|T1059|Eventid=1 Process="*cmd.exe" |






## Menu 
- [Back](https://threat-hunting.github.io/awesome_Threat-Hunting/Threat%20Hunting%20Rule%20Set)